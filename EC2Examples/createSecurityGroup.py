__author__ = 'anthonymcclay'
__project__ = 'botoExamples'
__date__ = '7/20/17'
__revision__ = '$'
__revision_date__ = '$'


import boto3
from botocore.exceptions import ClientError

ec2 = boto3.client('ec2')

response = ec2.describe_vpcs()
vpc_id = response.get('Vpcs', [{}])[0].get('VpcId', '')

SECURITY_GROUP_NAME='botoCreatedSecurityGroup2'
DESCRIPTION='A Boto Created Security group - createSecurityGroup.py'

try:
    response = ec2.create_security_group(GroupName=SECURITY_GROUP_NAME,
                                         Description=DESCRIPTION,
                                         VpcId=vpc_id)
    security_group_id = response['GroupId']
    print('Security Group Created %s in vpc %s.' % (security_group_id, vpc_id))

    ec2_tag = boto3.resource('ec2')
    security_group = ec2_tag.SecurityGroup(security_group_id)
    tag = security_group.create_tags(
    DryRun=False,
    Tags=[
        {
            'Key': 'Name',
            'Value': 'myBotoTag'
        },
    ])




    data = ec2.authorize_security_group_ingress(
        GroupId=security_group_id,
        IpPermissions=[
            {'IpProtocol': 'tcp',
             'FromPort': 80,
             'ToPort': 80,
             'IpRanges': [{'CidrIp': '0.0.0.0/0'}]},
            {'IpProtocol': 'tcp',
             'FromPort': 22,
             'ToPort': 22,
             'IpRanges': [{'CidrIp': '0.0.0.0/0'}]},
            {'IpProtocol': 'tcp',
             'FromPort': 8080,
             'ToPort': 8080,
             'IpRanges': [{'CidrIp': '0.0.0.0/0'}]}
        ])
    print('Ingress Successfully Set %s' % data)
except ClientError as e:
    print(e)

